{% extends "base.html" %} {% block title %}Editar Usuario{% endblock %} {% block
extra_css %}
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/editar_usuario.css') }}"
/>
{% endblock %} {% block content %}

<h2>Editar Usuario</h2>

<form
    action="{{ url_for('actualizar_usuario', id_usuario=usuario.id_usuario) }}"
    method="post"
    class="form-editar"
    onsubmit="return mostrarAlerta(event, this)"
    id="form-editar"
>
    <div>
        <label for="nombre">Nombres:</label>
        <input
            type="text"
            id="nombre"
            name="nombre"
            value="{{ usuario.nombre }}"
            readonly
        />
        <span class="no-editable">(No editable)</span>
    </div>

    <div>
        <label for="apellido">Apellido:</label>
        <input
            type="text"
            id="apellido"
            name="apellido"
            value="{{ usuario.apellido }}"
            readonly
        />
        <span class="no-editable">(No editable)</span>
    </div>

    <div>
        <label for="dni">DNI:</label>
        <input
            type="text"
            id="dni"
            name="dni"
            value="{{ usuario.dni }}"
            readonly
        />
        <span class="no-editable">(No editable)</span>
    </div>

    <div>
        <label for="telefono">Teléfono:</label>
        <input
            type="text"
            id="telefono"
            name="telefono"
            value="{{ usuario.telefono }}"
        />
    </div>

    <div>
        <label for="direccion">Dirección:</label>
        <input
            type="text"
            id="direccion"
            name="direccion"
            value="{{ usuario.direccion }}"
        />
    </div>

    <div>
        <label for="nro_direccion">N° Dirección:</label>
        <input
            type="number"
            id="nro_direccion"
            name="nro_direccion"
            value="{{ usuario.nro_direccion }}"
        />
    </div>

    <div class="botones">
        <button type="submit">Guardar Cambios</button>
        <a href="{{ url_for('usuarios') }}" class="btn-cancelar">Cancelar</a>
    </div>
</form>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document
        .querySelector("#form-editar")
        .addEventListener("submit", async (event) => {
            event.preventDefault();
            console.log(event);
            const form = event.target;
            const formData = new FormData(form);

            // Confirmación
            const result = await Swal.fire({
                title: "¿Guardar cambios?",
                text: "Se actualizarán los datos del usuario.",
                icon: "question",
                showCancelButton: true,
                confirmButtonColor: "var(--color-primario-oscuro)",
                cancelButtonColor: "var(--rojo-error)",
                confirmButtonText: "Sí, guardar",
                cancelButtonText: "Cancelar",
            });

            if (!result.isConfirmed) return;

            // Enviar datos vía fetch (sin recargar)
            const response = await fetch(form.action, {
                method: "POST",
                body: formData,
            });

            if (response.ok) {
                Swal.fire({
                    icon: "success",
                    title: "Cambios guardados",
                    text: "El usuario se actualizó correctamente.",
                    timer: 2000,
                    showConfirmButton: false,
                    willClose: () => {
                        // Redirigir cuando se cierre el alert
                        window.location.href = "{{ url_for('usuarios') }}";
                    },
                });
            } else {
                Swal.fire({
                    icon: "error",
                    title: "Error",
                    text: "Ocurrió un problema al guardar los cambios.",
                });
            }
        });
</script>
{% endblock %}
